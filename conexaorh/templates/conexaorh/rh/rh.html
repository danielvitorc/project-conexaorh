{% load static %}
<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="icon" href="https://encrypted-tbn2.gstatic.com/faviconV2?url=https://www.nortetech.net&client=VFE&size=64&type=FAVICON&fallback_opts=TYPE,SIZE,URL&nfrp=2" type="image/png">
    <title>{% block title %}RH/DP{% endblock %}</title>

    <!-- ================== CSS ================== -->
    <!-- Bibliotecas -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- CSS próprio (carregado por último ) -->
    <link rel="stylesheet" href="{% static 'conexaorh/css/geral.css' %}">
    
    <!-- ================== JAVASCRIPT ================== -->
    <!-- jQuery (carregado primeiro) -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <!-- Bootstrap JS (depende do Popper, que já vem no bundle ) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Outras bibliotecas JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

</head>
<body>

    {% include 'conexaorh/include/navbar.html' with pagina_ativa='rh_page' rh=True %}
    {% include "conexaorh/include/modal_detalhes.html" %}

    <div class="main-content">

        <!-- Card de boas-vindas -->
        <div class="card-welcome">
            <div class="welcome-text">
                <h1>Bem-vindo, {{ usuario.first_name }}</h1>
                <p>Esta é a área exclusiva para usuários do tipo <strong>RH</strong>.</p>
            </div>

            <div class="user-profile">
                <div class="profile-info">
                    <span class="user-name">{{ usuario.first_name }} {{ usuario.last_name }}</span>
                    <span class="user-role">{{ usuario.get_user_type_display }}</span>
                </div>
                <div class="dropdown-container">
                    <span class="dropdown-icon" onclick="toggleDropdown()">
                        <i class="fa fa-chevron-down"></i>
                    </span>

                    <div id="userDropdown" class="dropdown-menu">
                        <a href="{% url 'logout' %}" class="dropdown-item logout">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Templates de formulários (ocultos) -->
        <div id="formTemplates" style="display: none;">
            <!-- Formulário Filial -->
            <div id="filial-form-template">
                <form method="post" name="filial_form" class="modal-form">
                    {% csrf_token %}
                    {{ filial_form.as_p }}
                    <button type="submit" name="filial_submit" class="btn btn-primary">Cadastrar Filial</button>
                </form>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for filial in filiais %}
                        <tr>
                            <td>{{ filial.nome }}</td>
                            <td>
                                    <!-- Botão que abre o modal -->
                                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modalEditar{{ filial.id }}">
                                    Editar
                                    </button>

                                    <!-- Modal -->
                                    <div class="modal fade" id="modalEditar{{ filial.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <form method="POST" action="{% url 'editar_filial' filial.id %}">
                                        {% csrf_token %}
                                        <div class="modal-content">
                                            <div class="modal-header">
                                            <h5 class="modal-title">Editar Filial</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                                            </div>
                                            <div class="modal-body">
                                            <div class="mb-3">
                                                <label for="nome{{ filial.id }}" class="form-label">Nome da Filial</label>
                                                <input type="text" name="nome" id="nome{{ filial.id }}" class="form-control" value="{{ filial.nome }}" required>
                                            </div>
                                            </div>
                                            <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-success">Salvar Alterações</button>
                                            </div>
                                        </div>
                                        </form>
                                    </div>
                                    </div>

                                    <!-- Botão para excluir filial -->
                                    <a href="{% url 'excluir_filial' filial.id %}" 
                                    class="btn btn-danger btn-sm"
                                    onclick="return confirm('Tem certeza que deseja excluir esta filial?');"
                                    title="Excluir">
                                    <i class="bi bi-trash"></i>
                                    </a>

                                </td>
                        </tr>
                        {% empty %}
                        <tr>
                        <td colspan="2">Nenhuma filial encontrada.</td>
                        </tr>
                        {% endfor %}
                        
                    </tbody>
                </table>
            </div>

            <!-- Formulário Base -->
            <div id="base-form-template">
                <form method="post" name="base_form" class="modal-form">
                    {% csrf_token %}
                    {{ base_form.as_p }}
                    <button type="submit" name="base_submit" class="btn btn-primary">Cadastrar Base</button>
                </form>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Filial</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    {% for base in bases %}
                    <tbody>
                        <tr>
                            <td>{{ base.nome }}</td>
                            <td>{{ base.filial }}</td>
                            <td>
                                <!-- Botão que abre o modal -->
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#">
                                    Editar
                                </button>
                                 <!-- Botão para excluir base -->
                                <a href="{% url 'excluir_base' base.id %}" 
                                    class="btn btn-danger btn-sm"
                                    onclick="return confirm('Tem certeza que deseja excluir esta base?');"
                                    title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </a>

                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Formulário Setor -->
            <div id="setor-form-template">
                <form method="post" id="setor-form" class="modal-form">
                    {% csrf_token %}

                    <label for="nome-setor">Nome do Setor</label>
                    <input type="text" id="nome-setor" name="nome" class="form-control" required>

                    <label for="filial-select">Filial</label>
                    <select id="filial-select" name="filial" class="form-control" required>
                        <option value="">-- Escolha a filial --</option>
                        {% for filial in filiais %}
                            <option value="{{ filial.id }}">{{ filial.nome }}</option>
                        {% endfor %}
                    </select>

                    <label for="base-select">Base</label>
                    <select id="base-select" name="base" class="form-control">
                        <option value="">-- Escolha a base --</option>
                        <!-- Opções serão preenchidas via JS -->
                    </select>
                    <button type="submit" name="setor_submit" class="btn btn-primary">Cadastrar Setor</button>
                </form>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Base</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    {% for setor in setores %}
                    <tbody>
                        <tr>
                            <td>{{setor.nome}}</td>
                            <td>{{setor.base}}</td>
                            <td>
                                <!-- Botão que abre o modal -->
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#">
                                    Editar
                                </button>
                                 <!-- Botão para excluir setor -->
                                <a href="{% url 'excluir_setor' setor.id %}" 
                                    class="btn btn-danger btn-sm"
                                    onclick="return confirm('Tem certeza que deseja excluir este setor?');"
                                    title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </a>

                            </td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
            </div>

            <!-- Formulário Curso -->
            <div id="curso-form-template">
                <form method="post" name="curso_form" class="modal-form">
                    {% csrf_token %}
                    {{ curso_form.as_p }}
                    <button type="submit" name="curso_submit" class="btn btn-primary">Cadastrar Curso</button>
                </form>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    {% for curso in cursos %}
                    <tbody>
                        <tr>
                            <td>{{curso.nome}}</td>
                            <td>
                                <!-- Botão que abre o modal -->
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#">
                                    Editar
                                </button>
                                 <!-- Botão para excluir curso -->
                                <a href="{% url 'excluir_curso' curso.id %}" 
                                    class="btn btn-danger btn-sm"
                                    onclick="return confirm('Tem certeza que deseja excluir este curso?');"
                                    title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
            </div>

            <!-- Formulário Cargo -->
            <div id="cargo-form-template">
                <form method="post" id="cargo-form" class="modal-form">
                    {% csrf_token %}

                    <label for="cargo-nome">Nome do Cargo</label>
                    <input type="text" id="cargo-nome" name="nome" class="form-control" required>

                    <label for="filial-select-cargo">Filial</label>
                    <select id="filial-select-cargo" name="filial" class="form-control" required>
                        <option value="">-- Escolha a filial --</option>
                        {% for filial in filiais %}
                            <option value="{{ filial.id }}">{{ filial.nome }}</option>
                        {% endfor %}
                    </select>

                    <label for="base-select-cargo">Base</label>
                    <select id="base-select-cargo" name="base" class="form-control" required>
                        <option value="">-- Escolha a base --</option>
                    </select>

                    <label for="setores-select">Setores</label>
                    <select id="setores-select" name="setores" multiple class="select2-setores form-control" style="width: 100%;"></select>

                    <label for="cursos-select">Cursos</label>
                    {{ cargo_form.cursos }}

                    <button type="submit" name="cargo_submit" class="btn btn-primary">Cadastrar Cargo</button>
                </form>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    {% for cargo in cargos %}
                    <tbody>
                        <tr>
                            <td>{{ cargo.nome }}</td>
                            <td>
                                 <!-- Botão que abre o modal -->
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#">
                                    Editar
                                </button>
                                 <!-- Botão para excluir cargo -->
                                <a href="{% url 'excluir_cargo' cargo.id %}" 
                                    class="btn btn-danger btn-sm"
                                    onclick="return confirm('Tem certeza que deseja excluir este cargo?');"
                                    title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
            </div>
        </div>

        <div class="linha-amarela"></div>

        <!-- Card da tabela -->
        <div class="card-tabela-estilizada">
            <div class="tabela-header">
                <h3>Histórico de Requisições</h3>
                <div class="tabela-filtro">
                    <select id="filtroTipo">
                        <option value="Todos">Todos</option>
                        <option value="RP – Requisição Pessoal">RP</option>
                        <option value="MOV – Movimentação Pessoal">MOV</option>
                        <option value="RD – Requisição de Desligamento">RD</option>
                    </select>
                </div>
            </div>

            <table class="tabela-moderninha">
                <thead class="table-light">
                    <tr>
                        <th></th>
                        <th>Tipo</th>
                        <th>Requisitante</th>
                        <th>Data de Solicitação</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody>
                    {% for registro in registros %}
                        <tr>
                            <td class="">
                                {% if registro.tipo == "RP" %}
                                    <i class="bi bi-person-plus-fill text-primary"></i> <strong>RP</strong> – Requisição Pessoal
                                {% elif registro.tipo == "MOV" %}
                                    <i class="bi bi-arrow-left-right text-warning"></i> <strong>MOV</strong> – Movimentação Pessoal
                                {% elif registro.tipo == "RD" %}
                                    <i class="bi bi-door-closed-fill text-danger"></i> <strong>RD</strong> – Requisição de Desligamento
                                {% endif %}
                            </td>
                            <td>{{ registro.usuario.get_full_name }}</td>
                            <td>{{ registro.data_solicitacao|date:"d/m/Y - H:i" }}</td>
                            <td>
                                {% if registro.rh_aprovacao == 'AUTORIZADO' %}
                                    {% if registro.tipo == 'RP' %}
                                    <a href="{% url 'download_rp_excel' registro.id %}" class="btn btn-download btn-sm">
                                    <button class="btn btn-sm btn-success">Baixar Excel</button>
                                    </a>
                                    {% elif registro.tipo == 'MOV' %}
                                    <a href="{% url 'download_mov_excel' registro.id %}" class="btn btn-download btn-sm">
                                        <button class="btn btn-sm btn-success">Baixar Excel</button>
                                    </a>
                                    {% elif registro.tipo == 'RD' %}
                                    <a href="{% url 'download_rd_excel' registro.id %}" class="btn btn-download btn-sm">
                                        <button class="btn btn-sm btn-success">Baixar Excel</button>
                                    </a>
                                    {% endif %}
                                {% else %}
                                    ⛔ Não Autorizado
                                {% endif %}
                                {% if registro.tipo == 'RP' %}
                                    <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalRP{{ registro.id }}">
                                        Detalhes
                                    </button>
                                    <a href="{% url 'exportar_requisicao_pdf' %}?requisicao={{ registro.id }}" class="btn btn-danger btn-sm">
                                        Exportar PDF
                                    </a>
                                {% elif registro.tipo == 'MOV' %}
                                    <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalMOV{{ registro.id }}">
                                    Detalhes
                                    </button>
                                    <a href="{% url 'exportar_movimentacao_pdf' %}?movimentacao={{ registro.id }}" class="btn btn-danger btn-sm">
                                        Exportar PDF
                                    </a>

                                {% elif registro.tipo == 'RD' %}
                                    <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalRD{{ registro.id }}">
                                    Detalhes
                                    </button>
                                    <a href="{% url 'exportar_desligamento_pdf' %}?desligamento={{ registro.id }}" class="btn btn-danger btn-sm" target="_blank">
                                    Exportar PDF
                                    </a>

                                {% endif %}

                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4" class="text-center">Nenhum registro encontrado.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="tabela-rodape text-end">
                <a href="#">Ver todos <span>&rarr;</span></a>
            </div>
        </div>
    </div>

    <!-- Modal de Seleção de Formulários -->
    <div id="formSelectionModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Selecione o Formulário RH</h2>
            <div class="form-options-grid">
                <button class="form-option-card" data-form-id="filial-form-template">
                    <i class="bi bi-building"></i>
                    <span>Cadastrar Filial</span>
                </button>
                <button class="form-option-card" data-form-id="base-form-template">
                    <i class="bi bi-globe"></i>
                    <span>Cadastrar Base</span>
                </button>
                <button class="form-option-card" data-form-id="setor-form-template">
                    <i class="bi bi-diagram-3"></i>
                    <span>Cadastrar Setor</span>
                </button>
                <button class="form-option-card" data-form-id="curso-form-template">
                    <i class="bi bi-mortarboard"></i>
                    <span>Cadastrar Curso</span>
                </button>
                <button class="form-option-card" data-form-id="cargo-form-template">
                    <i class="bi bi-person-badge"></i>
                    <span>Cadastrar Cargo</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Exibição do Formulário -->
    <div id="formModal" class="modal form-modal">
        <div class="modal-content form-modal-content">
            <span class="close-button">&times;</span>
            <h2 class="modal-title">Formulário RH</h2>
            <div class="modal-form-container">
                <!-- O formulário selecionado será inserido aqui -->
            </div>
        </div>
    </div>
    <script>
        function toggleDropdown() {
            const menu = document.getElementById("userDropdown");
            const blur = document.getElementById("blur-background");

            const isOpen = menu.style.display === "block";
            menu.style.display = isOpen ? "none" : "block";
            blur.style.display = isOpen ? "none" : "block";
        }

        document.addEventListener("click", function (e) {
            const dropdown = document.getElementById("userDropdown");
            const icon = document.querySelector(".dropdown-icon");
            const blur = document.getElementById("blur-background");

            if (!dropdown.contains(e.target) && !icon.contains(e.target)) {
            dropdown.style.display = "none";
            blur.style.display = "none";
            }
        });
    </script>
    <script>
        document.getElementById("filtroTipo").addEventListener("change", function () {
            const tipoSelecionado = this.value;
            const linhas = document.querySelectorAll(".tabela-moderninha tbody tr");

            linhas.forEach(linha => {
                const tipo = linha.children[0]?.textContent.trim();

                if (tipoSelecionado === "Todos" || tipo === tipoSelecionado) {
                    linha.style.display = "";
                } else {
                    linha.style.display = "none";
                }
            });
        });
    </script>
    <script>
        $(document).ready(function() {
            // A inicialização do select2-cursos e select2-setores para o formulário de Cargo será feita na função initializeFormScripts
        });

        // Função para inicializar os scripts específicos dos formulários dinâmicos
        function initializeFormScripts(containerElement) {
            // Script para o formulário de Setor
            const filialSelect = containerElement.querySelector("#filial-select");
            const baseSelect = containerElement.querySelector("#base-select");

            if (filialSelect && baseSelect) {
                filialSelect.addEventListener("change", function () {
                    const filialId = this.value;
                    baseSelect.innerHTML = "<option value=\"\">Carregando...</option>";

                    if (!filialId) {
                        baseSelect.innerHTML = "<option value=\"\">-- Escolha a base --</option>";
                        return;
                    }

                    fetch(`/ajax/bases/?filial_id=${filialId}`)
                        .then(res => res.json())
                        .then(data => {
                            baseSelect.innerHTML = "<option value=\"\">-- Escolha a base --</option>";
                            data.bases.forEach(base => {
                                const option = document.createElement("option");
                                option.value = base.id;
                                option.textContent = base.nome;
                                baseSelect.appendChild(option);
                            });
                        })
                        .catch(() => {
                            baseSelect.innerHTML = "<option value=\"\">Erro ao carregar bases</option>";
                        });
                });
            }

            // Script para o formulário de Cargo
            const filialSelectCargo = containerElement.querySelector("#filial-select-cargo");
            const baseSelectCargo = containerElement.querySelector("#base-select-cargo");
            const setoresSelect = containerElement.querySelector("#setores-select");
            const cursosSelect = containerElement.querySelector(".select2-cursos"); // Seleciona o select de cursos

            if (filialSelectCargo && baseSelectCargo && setoresSelect) {
                // Re-inicializa Select2 para setores dentro do formulário de Cargo
                $(setoresSelect).select2({
                    placeholder: "Selecione os setores",
                    allowClear: true,
                    width: "100%",
                    ajax: {
                        url: "/ajax/setores/",
                        dataType: "json",
                        delay: 250,
                        data: function (params) {
                            const baseId = $(baseSelectCargo).val(); // Pega o valor atual da base selecionada
                            console.log("Buscando setores com base_id:", baseId, "e termo:", params.term);
                            return {
                                term: params.term,
                                base_id: baseId,
                            };
                        },
                        processResults: function (data) {
                            return {
                                results: data.results,
                            };
                        },
                        cache: true,
                    },
                });

                // Re-inicializa Select2 para cursos dentro do formulário de Cargo
                if (cursosSelect) {
                    $(cursosSelect).select2({
                        placeholder: "Selecione os cursos",
                        allowClear: true,
                        width: "100%",
                    });
                }

                // Event listener para filial no formulário de Cargo
                filialSelectCargo.addEventListener("change", function () {
                    const filialId = this.value;
                    console.log("Filial selecionada (Cargo):", filialId);
                    baseSelectCargo.innerHTML = "<option value=\"\">Carregando...</option>";
                    $(setoresSelect).val(null).trigger("change"); // Limpa seleção do Select2

                    if (!filialId) {
                        baseSelectCargo.innerHTML = "<option value=\"\">-- Escolha a base --</option>";
                        return;
                    }

                    fetch(`/ajax/bases/?filial_id=${filialId}`)
                        .then(res => res.json())
                        .then(data => {
                            baseSelectCargo.innerHTML = "<option value=\"\">-- Escolha a base --</option>";
                            data.bases.forEach(base => {
                                const option = document.createElement("option");
                                option.value = base.id;
                                option.textContent = base.nome;
                                baseSelectCargo.appendChild(option);
                            });
                        })
                        .catch(() => {
                            baseSelectCargo.innerHTML = "<option value=\"\">Erro ao carregar bases</option>";
                        });
                });

                // Event listener para base no formulário de Cargo
                baseSelectCargo.addEventListener("change", function () {
                    const baseId = this.value;
                    $(setoresSelect).val(null).trigger("change"); // Limpa seleção do Select2

                    if (!baseId) return;

                    // Como o Select2 já está configurado com AJAX, ele buscará os setores automaticamente
                    // quando a base mudar e o campo for ativado (clicado).
                    // Não é necessário um fetch manual aqui, apenas garantir que o Select2 saiba a nova base_id.
                });
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            const openFormModalBtn = document.getElementById("openFormModalBtn");
            const formSelectionModal = document.getElementById("formSelectionModal");
            const formModal = document.getElementById("formModal");
            const modalFormContainer = document.querySelector(".modal-form-container");

            if (!formSelectionModal || !formModal) return;

            const closeButtons = document.querySelectorAll(".close-button");
            const formOptionCards = formSelectionModal.querySelectorAll(".form-option-card");

            const formTitles = {
                "filial-form-template": "Cadastrar Filial",
                "base-form-template": "Cadastrar Base",
                "setor-form-template": "Cadastrar Setor",
                "curso-form-template": "Cadastrar Curso",
                "cargo-form-template": "Cadastrar Cargo"
            };

            function closeAllModals() {
                formSelectionModal.style.display = "none";
                formModal.style.display = "none";
                document.body.style.overflow = "auto";
            }

            function cleanupForm() {
                modalFormContainer.innerHTML = "";
            }

            if (openFormModalBtn) {
                openFormModalBtn.addEventListener("click", function (event) {
                    event.preventDefault();
                    formSelectionModal.style.display = "block";
                    document.body.style.overflow = "hidden";
                });
            }

            closeButtons.forEach(button => {
                button.addEventListener("click", function () {
                    cleanupForm();
                    closeAllModals();
                });
            });

            window.addEventListener("click", function (event) {
                if (event.target === formSelectionModal || event.target === formModal) {
                    cleanupForm();
                    closeAllModals();
                }
            });

            formOptionCards.forEach(card => {
                card.addEventListener("click", function () {
                    const formId = this.dataset.formId;
                    const formTemplate = document.getElementById(formId);

                    if (formTemplate) {
                        cleanupForm();

                        const modalTitle = document.querySelector(".modal-title");
                        modalTitle.textContent = formTitles[formId] || "Formulário RH";

                        const formClone = formTemplate.cloneNode(true);
                        formClone.style.display = "block";
                        modalFormContainer.appendChild(formClone);

                        // Chamar a função para inicializar os scripts do formulário recém-adicionado
                        initializeFormScripts(formClone);

                        formSelectionModal.style.display = "none";
                        formModal.style.display = "block";
                    }
                });
            });

            document.addEventListener("keydown", function (event) {
                if (event.key === "Escape") {
                    if (formModal.style.display === "block" || formSelectionModal.style.display === "block") {
                        cleanupForm();
                        closeAllModals();
                    }
                }
            });
        });
    </script>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="{% static 'conexaorh/js/tema.js' %}"></script>
</body>

</html>